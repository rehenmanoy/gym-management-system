<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Member Registration</title>
    <link rel="stylesheet" href="editmem.css">
</head>
<body>
    <div class="container">
        <button id="backButton">Back</button>
        <div class="left-section">
            <div class="logo-container">
                <img src="logo.jpg" alt="Gym Logo" class="logo">
            </div>
            <h2>Push Your Limits</h2>
            <h1>ALL DAY</h1>
        </div>
        <div class="right-section">
            <!-- Back button inside the right section at the top-right -->
            

            <div class="form-container">
                <h2>Update Member</h2>

                <form id="registrationForm">
                    <input type="text" id="name" placeholder="Name" required>
                    <input type="email" id="email" placeholder="Email" required>
                    <input type="tel" id="phone" placeholder="Phone Number" required>
                    <div class="radio-group">
                        <label><input type="radio" name="gender" value="male" required> Male</label>
                        <label><input type="radio" name="gender" value="female" required> Female</label>
                    </div>
                    <label style="color: white;">Date Of Birth : &nbsp; &nbsp;<input type="date" id="dob" placeholder="Date of Birth" required></label>
                    <label style="color: white;">Membership Start Date: &nbsp;<input type="date" id="startDate" placeholder="Membership Start Date" required></label>
                    <div class="radio-group">
                        <label><input type="radio" name="plan" value="monthly" required> Monthly</label>
                        <label><input type="radio" name="plan" value="annual" required> Annual</label>
                        <label><input type="radio" name="plan" value="pt" required> Personal Training</label>
                    </div>
                    <input type="text" id="trainer" placeholder="Assigned Trainer (if PT)">
                    <select id="fitnessGoals" required>
                        <option value="">Select Fitness Goal</option>
                        <option value="weightLoss">Weight Loss</option>
                        <option value="muscleGain">Muscle Gain</option>
                        <option value="endurance">Endurance</option>
                        <option value="flexibility">Flexibility</option>
                    </select>
                    <div class="radio-group">
                        <label><input type="radio" name="paymentStatus" value="paid" required> Paid</label>
                        <label><input type="radio" name="paymentStatus" value="notPaid" required> Not Paid</label>
                    </div>
                    <button type="submit">Update Member</button>
                </form>
            </div>
        </div>
    </div>

    <div class="confirm-overlay"></div>
    <div class="confirm-dialog" id="confirmDialog">
        <h3>Are You Sure You want To go Back?</h3>
        <button id="confirm-yes">Yes</button>
        <button id="confirm-no">No</button>
    </div>

    <script>
        const backButton = document.getElementById('backButton');
    const confirmDialog = document.getElementById('confirmDialog');
    const confirmOverlay = document.querySelector('.confirm-overlay');
    
    // Show dialog and overlay when back button is clicked
    backButton.addEventListener('click', function() {
        confirmDialog.style.display = 'block';
        confirmOverlay.style.display = 'block';
    });

    // Close the dialog box and overlay when "No" button is clicked
    document.getElementById('confirm-no').addEventListener('click', closeDialogBox);
    confirmOverlay.addEventListener('click', closeDialogBox);

    function closeDialogBox() {
        confirmDialog.style.display = 'none';
        confirmOverlay.style.display = 'none';
    }

    // Redirect if "Yes" is clicked
    document.getElementById('confirm-yes').addEventListener('click', function() {
        window.location.href = 'viewmem.html'; // Adjust the path as needed
    });
    registrationForm.addEventListener('submit', async function(event) {
        event.preventDefault(); // Prevent default form submission

        const memberId = new URLSearchParams(window.location.search).get('id');  // Get the 'id' from URL
        if (!memberId) {
            alert('No member ID found.');
            return;
        }
        const formData = {
            id: memberId, 
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            phone: document.getElementById('phone').value,
            gender: document.querySelector('input[name="gender"]:checked').value,
            dob: document.getElementById('dob').value,
            startDate: document.getElementById('startDate').value,
            plan: document.querySelector('input[name="plan"]:checked').value,
            trainer: document.getElementById('trainer').value,
            fitnessGoals: document.getElementById('fitnessGoals').value,
            paymentStatus: document.querySelector('input[name="paymentStatus"]:checked').value
        };

        try {
            const response = await fetch('http://localhost:5550/user/member/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            
            if (response.ok) {
                alert(result.message); // Display success message
                registrationForm.reset(); // Clear the form
                window.location.href = 'viewmem.html';
            } else {
                alert('Registration failed: ' + result.message); // Display error message
            }
        } catch (error) {
            console.error('Error:', error);
            alert('An error occurred during registration.');
        }
    });
            window.onload = async function() {
            const urlParams = new URLSearchParams(window.location.search);
            const memberId = urlParams.get('id');
            
            if (memberId) {
                // Fetch member details and populate form
                const response = await fetch(`http://localhost:5550/user/member/${memberId}`);
                const member = await response.json();
                
                if (response.ok) {
                    document.getElementById('name').value = member.name;
                    document.getElementById('email').value = member.email;
                    document.getElementById('phone').value = member.phone;
                    document.querySelector(`input[name="gender"][value="${member.gender}"]`).checked = true;

                    document.getElementById('dob').value = new Date(member.dob).toISOString().split('T')[0];
                    document.getElementById('startDate').value = new Date(member.startDate).toISOString().split('T')[0];


                    document.querySelector(`input[name="plan"][value="${member.plan}"]`).checked = true;
                    document.getElementById('trainer').value = member.trainer || '';
                    document.getElementById('fitnessGoals').value = member.fitnessGoals;
                    document.querySelector(`input[name="paymentStatus"][value="${member.paymentStatus}"]`).checked = true;
                } else {
                    alert('Failed to load member details');
                }
            }
        };
    </script>
</body>
</html>
